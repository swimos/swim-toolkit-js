<!DOCTYPE html>
<html>
  <head>
    <title>Swim Tree View</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0, shrink-to-fit=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
      html, body {
        -webkit-tap-highlight-color: transparent;
      }
    </style>
  </head>
  <body swim-theme style="display: flex; width: 100vw; height: 100vh; margin: 0;">
    <script src="../../swim-runtime/swim-core/dist/swim-core.js"></script>
    <script src="../../swim-runtime/swim-host/dist/swim-host.js"></script>
    <script src="../swim-ui/dist/swim-ui.js"></script>
    <script src="../swim-ux/dist/swim-ux.js"></script>
    <script>

const bodyView = swim.HtmlView.fromNode(document.body);

const containerView = swim.HtmlView.create("div");
containerView.position.setState("relative");
containerView.flexGrow.setState(1);
containerView.userSelect.setState("none");

containerView.observe({
  viewWillResize(view) {
    if (view.viewIdiom === "desktop") {
      view.margin(60);
    } else {
      view.margin(0);
    }
  },
});

bodyView.appendChild(containerView);

const tableLayout = swim.TableLayout.fromLike({
  cols: [
    {
      key: "icon",
      shrink: 0,
      basis: 80,
      persistent: true,
    },
    {
      key: "name",
      grow: 1,
      basis: 240,
      textColor: swim.Look.textColor,
    },
    {
      key: "kpi1",
      optional: true,
      basis: 120,
      textColor: swim.Look.labelColor,
    },
    {
      key: "kpi2",
      optional: true,
      basis: 120,
      textColor: swim.Look.labelColor,
    },
    {
      key: "accessory",
      shrink: 0,
      basis: 60,
    },
  ],
});

const icon = swim.PolygonIcon.create(6);

const tableView = swim.TableView.create();
tableView.layout.setValue(tableLayout);
tableView.rowHeight.setState(58);
tableView.rowSpacing.setState(2);
tableView.modifyTheme(swim.Feel.default, [[swim.Feel.primary, 1]]);

const headerView = tableView.header.insertView();
headerView.getOrCreateCol("icon", swim.DisclosureColView);
const nameColView = headerView.getOrCreateCol("name", swim.TextColView);
nameColView.label.setText("Name");
const kpi1ColView = headerView.getOrCreateCol("kpi1", swim.TextColView);
kpi1ColView.label.setText("KPI 1");
const kpi2ColView = headerView.getOrCreateCol("kpi2", swim.TextColView);
kpi2ColView.label.setText("KPI 2");

const row0View = tableView.appendChild(swim.RowView);
const leaf0View = row0View.leaf.insertView();
const icon0View = leaf0View.appendChild(swim.IconCellView, "icon");
icon0View.iconLayout.setValue({width: 40, height: 40});
icon0View.graphics.setState(icon);
const name0View = leaf0View.appendChild(swim.TextCellView, "name");
name0View.content.setText("Row 0");
leaf0View.appendChild(swim.DisclosureCellView, "accessory");
row0View.head.insertView();
row0View.foot.insertView();
const tree0View = row0View.tree.insertView();
const header0View = tree0View.header.insertView();
header0View.getOrCreateCol("icon", swim.DisclosureColView);
header0View.getOrCreateCol("name", swim.TextColView).label.setText("Name");
header0View.getOrCreateCol("kpi1", swim.TextColView).label.setText("KPI 1");
header0View.getOrCreateCol("kpi2", swim.TextColView).label.setText("KPI 2");
const row00View = tree0View.appendChild(swim.RowView);
const leaf00View = row00View.leaf.insertView();
const icon00View = leaf00View.appendChild(swim.IconCellView, "icon")
icon00View.iconLayout.setValue({width: 40, height: 40});
icon00View.graphics.setState(icon);
const name00View = leaf00View.appendChild(swim.TextCellView, "name");
name00View.content.setText("Row 0-0");
const row01View = tree0View.appendChild(swim.RowView);
const leaf01View = row01View.leaf.insertView();
const icon01View = leaf01View.appendChild(swim.IconCellView, "icon");
icon01View.iconLayout.setValue({width: 40, height: 40});
icon01View.graphics.setState(icon);
const name01View = leaf01View.appendChild(swim.TextCellView, "name");
name01View.content.setText("Row 0-1");
const row02View = tree0View.appendChild(swim.RowView);
const leaf02View = row02View.leaf.insertView();
const icon02View = leaf02View.appendChild(swim.IconCellView, "icon");
icon02View.iconLayout.setValue({width: 40, height: 40});
icon02View.graphics.setState(icon);
const name02View = leaf02View.appendChild(swim.TextCellView, "name");
name02View.content.setText("Row 0-2");

leaf01View.appendChild(swim.DisclosureCellView, "accessory");
row01View.head.insertView();
row01View.foot.insertView();
const tree01View = row01View.tree.insertView();
const header01View = tree01View.header.insertView();
header01View.getOrCreateCol("icon", swim.DisclosureColView);
header01View.getOrCreateCol("name", swim.TextColView).label.setText("Name");
header01View.getOrCreateCol("kpi1", swim.TextColView).label.setText("KPI 1");
header01View.getOrCreateCol("kpi2", swim.TextColView).label.setText("KPI 2");
const row010View = tree01View.appendChild(swim.RowView);
const leaf010View = row010View.leaf.insertView();
const icon010View = leaf010View.appendChild(swim.IconCellView, "icon");
icon010View.iconLayout.setValue({width: 40, height: 40});
icon010View.graphics.setValue(icon);
const name010View = leaf010View.appendChild(swim.TextCellView, "name");
name010View.content.setText("Row 0-1-0");
const row011View = tree01View.appendChild(swim.RowView);
const leaf011View = row011View.leaf.insertView();
const icon011View = leaf011View.appendChild(swim.IconCellView, "icon");
icon011View.iconLayout.setValue({width: 40, height: 40});
icon011View.graphics.setState(icon);
const name011View = leaf011View.appendChild(swim.TextCellView, "name");
name011View.content.setText("Row 0-1-1");

const row1View = tableView.appendChild(swim.RowView);
const leaf1View = row1View.leaf.insertView();
const icon1View = leaf1View.appendChild(swim.IconCellView, "icon");
icon1View.iconLayout.setValue({width: 40, height: 40});
icon1View.graphics.setState(icon);
leaf1View.appendChild(swim.TextCellView, "name").content.setText("Row 1");
leaf1View.appendChild(swim.DisclosureCellView, "accessory");
row1View.head.insertView();
row1View.foot.insertView();
const tree1View = row1View.tree.insertView();
const header1View = tree1View.header.insertView();
header1View.getOrCreateCol("icon", swim.DisclosureColView);
header1View.getOrCreateCol("name", swim.TextColView).label.setText("Name");
header1View.getOrCreateCol("kpi1", swim.TextColView).label.setText("KPI 1");
header1View.getOrCreateCol("kpi2", swim.TextColView).label.setText("KPI 2");
const row10View = tree1View.appendChild(swim.RowView);
const leaf10View = row10View.leaf.insertView();
const icon10View = leaf10View.appendChild(swim.IconCellView, "icon");
icon10View.iconLayout.setValue({width: 40, height: 40});
icon10View.graphics.setValue(icon);
const name10View = leaf10View.appendChild(swim.TextCellView, "name");
name10View.content.setText("Row 1-0");
const row11View = tree1View.appendChild(swim.RowView);
const leaf11View = row11View.leaf.insertView();
const icon11View = leaf11View.appendChild(swim.IconCellView, "icon");
icon11View.iconLayout.setValue({width: 40, height: 40});
icon11View.graphics.setState(icon);
const name11View = leaf11View.appendChild(swim.TextCellView, "name");
name11View.content.setText("Row 1-1");
const row12View = tree1View.appendChild(swim.RowView);
const leaf12View = row12View.leaf.insertView();
const icon12View = leaf12View.appendChild(swim.IconCellView, "icon");
icon12View.iconLayout.setValue({width: 40, height: 40});
icon12View.graphics.setState(icon);
const name12View = leaf12View.appendChild(swim.TextCellView, "name");
name12View.content.setText("Row 1-2");
const row13View = tree1View.appendChild(swim.RowView);
const leaf13View = row13View.leaf.insertView();
const icon13View = leaf13View.appendChild(swim.IconCellView, "icon");
icon13View.iconLayout.setValue({width: 40, height: 40});
icon13View.graphics.setState(icon);
const name13View = leaf13View.appendChild(swim.TextCellView, "name");
name13View.content.setText("Row 1-3");

leaf12View.appendChild(swim.DisclosureCellView, "accessory");
row12View.head.insertView();
row12View.foot.insertView();
const tree12View = row12View.tree.insertView();
const header12View = tree12View.header.insertView();
header12View.getOrCreateCol("icon", swim.DisclosureColView);
header12View.getOrCreateCol("name", swim.TextColView).label.setText("Name");
header12View.getOrCreateCol("kpi1", swim.TextColView).label.setText("KPI 1");
header12View.getOrCreateCol("kpi2", swim.TextColView).label.setText("KPI 2");
const row120View = tree12View.appendChild(swim.RowView);
const leaf120View = row120View.leaf.insertView();
const icon120View = leaf120View.appendChild(swim.IconCellView, "icon");
icon120View.iconLayout.setValue({width: 40, height: 40});
icon120View.graphics.setState(icon);
const name120View = leaf120View.appendChild(swim.TextCellView, "name");
name120View.content.setText("Row 1-2-0");
const row121View = tree12View.appendChild(swim.RowView);
const leaf121View = row121View.leaf.insertView();
const icon121View = leaf121View.appendChild(swim.IconCellView, "icon");
icon121View.iconLayout.setValue({width: 40, height: 40});
icon121View.graphics.setState(icon);
const name121View = leaf121View.appendChild(swim.TextCellView, "name");
name121View.content.setText("Row 1-2-1");

containerView.appendChild(tableView);

function updateMood(view) {
  const warnThreshold = 0.8;
  const alertThreshold = 0.95;
  let u = Math.random();
  if (u < warnThreshold) {
    view.modifyMood(swim.Feel.default, [[swim.Feel.warning, void 0], [swim.Feel.alert, void 0]]);
  } else if (u < alertThreshold) {
    u = (u - warnThreshold) / (alertThreshold - warnThreshold);
    u = 0.6 + 0.4 * u;
    view.modifyMood(swim.Feel.default, [[swim.Feel.warning, 1], [swim.Feel.alert, void 0]]);
  } else {
    u = (u - alertThreshold) / (1 - alertThreshold);
    u = 0.6 + 0.4 * u;
    view.modifyMood(swim.Feel.default, [[swim.Feel.warning, void 0], [swim.Feel.alert, u]]);
  }
}
function updateMoods() {
  updateMood(leaf0View);
  updateMood(leaf00View);
  updateMood(leaf01View);
  updateMood(leaf010View);
  updateMood(leaf011View);
  updateMood(leaf02View);
  updateMood(leaf1View);
  updateMood(leaf10View);
  updateMood(leaf11View);
  updateMood(leaf12View);
  updateMood(leaf120View);
  updateMood(leaf121View);
  updateMood(leaf13View);
}
setInterval(updateMoods, 4000);
updateMoods();

//setTimeout(function () {
//  const timing = swim.Easing.cubicOut.withDuration(2000);
//  row0View.disclosure.expand(timing);
//  row01View.disclosure.expand(timing);
//  row1View.disclosure.expand(timing);
//  row12View.disclosure.expand(timing);
//  setInterval(function () {
//    row0View.disclosure.toggle(timing);
//    row1View.disclosure.toggle(timing);
//  }, 3000);
//}, 1000);

    </script>
  </body>
</html>
